<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Simon Says - Robinsons Game Arcade</title>
    <link rel="stylesheet" href="../../css/main.css">
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>üî¥ Simon Says</h1>
            <a href="../../index.html" class="back-btn">‚Üê Back to Games</a>
        </div>

        <div class="game-info">
            <div class="info-box">
                <label>Score</label>
                <span id="score">0</span>
            </div>
            <div class="info-box">
                <label>High Score</label>
                <span id="highScore">0</span>
            </div>
        </div>

        <div id="message" class="simon-message">Press Start to begin!</div>

        <div class="simon-board">
            <button class="simon-btn" data-color="green" id="green"></button>
            <button class="simon-btn" data-color="red" id="red"></button>
            <button class="simon-btn" data-color="yellow" id="yellow"></button>
            <button class="simon-btn" data-color="blue" id="blue"></button>
            <div class="simon-center">
                <span id="levelDisplay">0</span>
            </div>
        </div>

        <div class="game-controls">
            <button id="startBtn" class="game-btn">Start Game</button>
        </div>

        <div class="difficulty-select">
            <button class="diff-btn active" data-speed="1000">Normal</button>
            <button class="diff-btn" data-speed="600">Fast</button>
            <button class="diff-btn" data-speed="400">Extreme</button>
        </div>

        <div class="instructions">
            <h3>How to Play</h3>
            <p>Watch the pattern and repeat it! Each round adds one more color to remember. How long can you go?</p>
        </div>
    </div>

    <style>
        .simon-message {
            text-align: center;
            font-size: 1.3rem;
            margin: 20px 0;
            min-height: 30px;
            color: var(--text-secondary);
        }

        .simon-board {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 30px auto;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .simon-btn {
            position: absolute;
            width: 50%;
            height: 50%;
            border: 4px solid #1e293b;
            cursor: pointer;
            transition: filter 0.1s, transform 0.1s;
            -webkit-tap-highlight-color: transparent;
        }

        .simon-btn:active, .simon-btn.active {
            filter: brightness(1.5);
            transform: scale(0.98);
        }

        .simon-btn[data-color="green"] {
            top: 0;
            left: 0;
            background: #22c55e;
            border-radius: 100% 0 0 0;
        }

        .simon-btn[data-color="red"] {
            top: 0;
            right: 0;
            background: #ef4444;
            border-radius: 0 100% 0 0;
        }

        .simon-btn[data-color="yellow"] {
            bottom: 0;
            left: 0;
            background: #eab308;
            border-radius: 0 0 0 100%;
        }

        .simon-btn[data-color="blue"] {
            bottom: 0;
            right: 0;
            background: #3b82f6;
            border-radius: 0 0 100% 0;
        }

        .simon-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .simon-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            background: #1e293b;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: white;
            box-shadow: inset 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .difficulty-select {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .diff-btn {
            background: #1e293b;
            color: #94a3b8;
            border: 2px solid #334155;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .diff-btn:hover, .diff-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        @media (max-width: 400px) {
            .simon-board {
                width: 260px;
                height: 260px;
            }
            .simon-center {
                width: 80px;
                height: 80px;
                font-size: 1.5rem;
            }
        }
    </style>

    <script>
        const buttons = document.querySelectorAll('.simon-btn');
        const messageEl = document.getElementById('message');
        const scoreEl = document.getElementById('score');
        const highScoreEl = document.getElementById('highScore');
        const levelDisplay = document.getElementById('levelDisplay');
        const startBtn = document.getElementById('startBtn');

        const COLORS = ['green', 'red', 'yellow', 'blue'];
        const SOUNDS = {
            green: 329.63,  // E4
            red: 261.63,    // C4
            yellow: 220.00, // A3
            blue: 164.81    // E3
        };

        let sequence = [];
        let playerSequence = [];
        let level = 0;
        let isPlaying = false;
        let isPlayerTurn = false;
        let speed = 1000;
        let highScore = parseInt(localStorage.getItem('simonHighScore')) || 0;
        let audioContext = null;

        highScoreEl.textContent = highScore;

        // Initialize audio context on user interaction
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playTone(color, duration = 300) {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = SOUNDS[color];
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration / 1000);
        }

        function flashButton(color, duration = 300) {
            const btn = document.getElementById(color);
            btn.classList.add('active');
            playTone(color, duration);
            setTimeout(() => btn.classList.remove('active'), duration);
        }

        function addToSequence() {
            const randomColor = COLORS[Math.floor(Math.random() * 4)];
            sequence.push(randomColor);
        }

        async function playSequence() {
            isPlayerTurn = false;
            setButtonsEnabled(false);
            messageEl.textContent = 'Watch carefully...';

            for (let i = 0; i < sequence.length; i++) {
                await sleep(speed * 0.3);
                flashButton(sequence[i], speed * 0.6);
                await sleep(speed * 0.7);
            }

            await sleep(300);
            isPlayerTurn = true;
            setButtonsEnabled(true);
            playerSequence = [];
            messageEl.textContent = 'Your turn!';
        }

        function handleButtonClick(color) {
            if (!isPlayerTurn) return;

            initAudio();
            flashButton(color, 200);
            playerSequence.push(color);

            const currentIndex = playerSequence.length - 1;

            if (playerSequence[currentIndex] !== sequence[currentIndex]) {
                gameOver();
                return;
            }

            if (playerSequence.length === sequence.length) {
                isPlayerTurn = false;
                setButtonsEnabled(false);
                level++;
                levelDisplay.textContent = level;
                scoreEl.textContent = level;
                messageEl.textContent = 'Correct! üéâ';

                setTimeout(() => {
                    addToSequence();
                    playSequence();
                }, 1000);
            }
        }

        function setButtonsEnabled(enabled) {
            buttons.forEach(btn => btn.disabled = !enabled);
        }

        function gameOver() {
            isPlaying = false;
            isPlayerTurn = false;
            setButtonsEnabled(false);
            
            // Play error sound
            if (audioContext) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.frequency.value = 100;
                oscillator.type = 'sawtooth';
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            }

            messageEl.textContent = `Game Over! Score: ${level}`;
            startBtn.textContent = 'Play Again';
            startBtn.style.display = 'inline-block';

            if (level > highScore) {
                highScore = level;
                highScoreEl.textContent = highScore;
                localStorage.setItem('simonHighScore', highScore);
                messageEl.textContent = `New High Score: ${level}! üèÜ`;
            }

            if (window.RobinsonsArcade) {
                RobinsonsArcade.updateHighScore('simon', level);
            }
        }

        function startGame() {
            initAudio();
            sequence = [];
            playerSequence = [];
            level = 0;
            isPlaying = true;
            levelDisplay.textContent = '0';
            scoreEl.textContent = '0';
            startBtn.style.display = 'none';

            addToSequence();
            setTimeout(playSequence, 500);
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Event listeners
        buttons.forEach(btn => {
            btn.addEventListener('click', () => handleButtonClick(btn.dataset.color));
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (isPlayerTurn) handleButtonClick(btn.dataset.color);
            });
        });

        startBtn.addEventListener('click', startGame);

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (!isPlayerTurn) return;
            
            const keyMap = {
                'q': 'green', '1': 'green',
                'w': 'red', '2': 'red',
                'a': 'yellow', '3': 'yellow',
                's': 'blue', '4': 'blue'
            };
            
            if (keyMap[e.key.toLowerCase()]) {
                handleButtonClick(keyMap[e.key.toLowerCase()]);
            }
        });

        // Difficulty
        document.querySelectorAll('.diff-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                speed = parseInt(btn.dataset.speed);
            });
        });

        // Initialize
        setButtonsEnabled(false);
    </script>
</body>
</html>
